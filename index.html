<html>
  <head>
    <title>Chaldean Numerology Calculator</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
  </head>
  <body>
    <h1>String Calculator</h1><br>
    <h3>Input</h3>
    <textarea id="numero-in" style="width: 200px;height: 250px;"></textarea>
    <label>Initial Character: </label>
    <select name="start-filter" id="start-filter">
      <option value="">No Filter</option>
      <option value="#">Number</option>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
      <option value="E">E</option>
      <option value="F">F</option>
      <option value="G">G</option>
      <option value="H">H</option>
      <option value="I">I</option>
      <option value="J">J</option>
      <option value="K">K</option>
      <option value="L">L</option>
      <option value="M">M</option>
      <option value="N">N</option>
      <option value="O">O</option>
      <option value="P">P</option>
      <option value="Q">Q</option>
      <option value="R">R</option>
      <option value="S">S</option>
      <option value="T">T</option>
      <option value="U">U</option>
      <option value="V">V</option>
      <option value="W">W</option>
      <option value="X">X</option>
      <option value="Y">Y</option>
      <option value="Z">Z</option>
    </select><br>
    <label>Final Result: </label>
    <select name="result-filter" id="result-filter">
      <option value="">No Filter</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
    </select>
    <br>
    <h3>Results</h3>
    <span id="numero-out"></span>
  </body>
  <script>
    num=[
        ['a','i','j','q','y'],
        ['b','k','r'],
        ['c','g','l','s'],
        ['d','m','t'],
        ['e','h','n','x'],
        ['u','v','w'],
        ['o','z'],
        ['f','p']
    ]

    String.prototype.ncalc = function() {
        finalAns=0;
        this.toLowerCase().split('').forEach((chr, index, arr) => {
            assignedNum=parseInt(chr) || 0;
            num.forEach(function(el) {
                if (el.find(el => el==chr))
                    assignedNum=num.indexOf(el)+1;
            });
            finalAns+=assignedNum;
        });
        original = finalAns;
        digitalRoot = function (rnum) {
            rnum = parseInt(rnum);
            if(rnum < 10)
                return rnum;
            tmp=0;
            rnum.toString().split('').forEach(el => tmp=tmp+parseInt(el));
            return digitalRoot(tmp);
        }
        return original+" ~"+digitalRoot(finalAns).toString();
    }
    
    document.getElementById('numero-in').oninput = (() => updateResults())
    document.getElementById('start-filter').onchange = (() => updateResults())
    document.getElementById('result-filter').onchange = (() => updateResults())
    
    function updateResults() {
      document.getElementById("numero-out").innerHTML = "";
      document.getElementById("numero-in").value.split("\n").forEach(word => {
        filterPref = document.getElementById('result-filter').value == '' || document.getElementById('result-filter').value == word.ncalc().split('~')[1];
        filterPref = filterPref && (document.getElementById('start-filter').value == '' || document.getElementById('result-filter').value == word[0] || 
                                    (document.getElementById('result-filter').value == '#' && !Number.isNaN(parseInt(word[0])) ))
        if(word.length != 0 && filterPref)
          document.getElementById("numero-out").innerHTML += word + " (" + word.ncalc() + ")<br>"
        else document.getElementById("numero-out").innerHTML += "<br/>"
      })
    }
</script>
</html>
